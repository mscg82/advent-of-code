package com.mscg;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;

public class AdventDay17Test {

    @Test
    public void testParse() throws Exception {
        try (BufferedReader in = readInput()) {
            var cubeSat = CubeSat.parseInput(in, 0, 1, 2, 2);
            Assertions.assertEquals("""
                    z=-1, w=0
                    .......
                    .......
                    .......
                    .......
                    .......
                    .......
                    .......
                                        
                    z=0, w=0
                    .......
                    .......
                    ...#...
                    ....#..
                    ..###..
                    .......
                    .......
                                        
                    z=1, w=0
                    .......
                    .......
                    .......
                    .......
                    .......
                    .......
                    .......""", cubeSat.toString());
        }
    }

    @Test
    public void testEvolve1() throws Exception {
        try (BufferedReader in = readInput()) {
            var cubeSat = CubeSat.parseInput(in, 0, 3, 3, 3);
            Assertions.assertEquals("""
                    z=-3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                        
                    z=-2, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                       
                    z=-1, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                       
                    z=0, w=0
                    .........
                    .........
                    .........
                    ....#....
                    .....#...
                    ...###...
                    .........
                    .........
                    .........
                                       
                    z=1, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                       
                    z=2, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                       
                    z=3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........""", cubeSat.toString());

            var cubeSat1 = cubeSat.next();
            Assertions.assertEquals("""
                    z=-3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                        
                    z=-2, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                        
                    z=-1, w=0
                    .........
                    .........
                    .........
                    .........
                    ...#.....
                    .....#...
                    ....#....
                    .........
                    .........
                                        
                    z=0, w=0
                    .........
                    .........
                    .........
                    .........
                    ...#.#...
                    ....##...
                    ....#....
                    .........
                    .........
                                        
                    z=1, w=0
                    .........
                    .........
                    .........
                    .........
                    ...#.....
                    .....#...
                    ....#....
                    .........
                    .........
                                        
                    z=2, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                        
                    z=3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........""", cubeSat1.toString());

            var cubeSat2 = cubeSat1.next();
            Assertions.assertEquals("""
                    z=-3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                                 
                    z=-2, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    ....#....
                    .........
                    .........
                    .........
                                                 
                    z=-1, w=0
                    .........
                    .........
                    .........
                    ....#....
                    ...#..#..
                    ......#..
                    ...#.....
                    .........
                    .........
                                                 
                    z=0, w=0
                    .........
                    .........
                    .........
                    ..##.....
                    ..##.....
                    ..#......
                    ......#..
                    ...###...
                    .........
                                                 
                    z=1, w=0
                    .........
                    .........
                    .........
                    ....#....
                    ...#..#..
                    ......#..
                    ...#.....
                    .........
                    .........
                                                 
                    z=2, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    ....#....
                    .........
                    .........
                    .........
                                                 
                    z=3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........""", cubeSat2.toString());

            var cubeSat3 = cubeSat2.next();
            Assertions.assertEquals("""
                    z=-3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                                        
                    z=-2, w=0
                    .........
                    .........
                    .........
                    .........
                    ...##....
                    ...###...
                    .........
                    .........
                    .........
                                        
                    z=-1, w=0
                    .........
                    .........
                    ...#.....
                    ....#....
                    .#.......
                    ......##.
                    ..#...#..
                    ...#.#...
                    ....#....
                                        
                    z=0, w=0
                    .........
                    .........
                    ....#....
                    .........
                    .#.......
                    .........
                    ......##.
                    ..##.#...
                    ....#....
                                        
                    z=1, w=0
                    .........
                    .........
                    ...#.....
                    ....#....
                    .#.......
                    ......##.
                    ..#...#..
                    ...#.#...
                    ....#....
                                        
                    z=2, w=0
                    .........
                    .........
                    .........
                    .........
                    ...##....
                    ...###...
                    .........
                    .........
                    .........
                                        
                    z=3, w=0
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........
                    .........""", cubeSat3.toString());
        }
    }


    @Test
    public void testEvolve2() throws Exception {
        try (BufferedReader in = readInput()) {
            var cubeSat = CubeSat.parseInput(in, 1, 1, 1, 1);

            Assertions.assertEquals("""
                    z=-1, w=-1
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=0, w=-1
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=1, w=-1
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=-1, w=0
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=0, w=0
                    .....
                    ..#..
                    ...#.
                    .###.
                    .....
                                               
                    z=1, w=0
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=-1, w=1
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=0, w=1
                    .....
                    .....
                    .....
                    .....
                    .....
                                               
                    z=1, w=1
                    .....
                    .....
                    .....
                    .....
                    .....""", cubeSat.toString());

            var cubeSat1 = cubeSat.next();

            Assertions.assertEquals("""
                    z=-1, w=-1
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=0, w=-1
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=1, w=-1
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=-1, w=0
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=0, w=0
                    .....
                    .....
                    .#.#.
                    ..##.
                    ..#..
                                               
                    z=1, w=0
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=-1, w=1
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=0, w=1
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..
                                               
                    z=1, w=1
                    .....
                    .....
                    .#...
                    ...#.
                    ..#..""", cubeSat1.toString());

        }
    }

    @Test
    public void testProblem1() throws Exception {
        try (BufferedReader in = readInput()) {
            var cubeSat = CubeSat.parseInput(in, 0, 6, 6, 6);
            var booted = cubeSat.boot();
            final long activeCells = booted.stream().filter(s -> s == CubeSat.CubeState.ACTIVE).count();
            Assertions.assertEquals(112, activeCells);
        }
    }

    @Test
    public void testProblem2() throws Exception {
        try (BufferedReader in = readInput()) {
            var cubeSat = CubeSat.parseInput(in, 6, 6, 6, 6);
            var booted = cubeSat.boot();
            final long activeCells = booted.stream().filter(s -> s == CubeSat.CubeState.ACTIVE).count();
            Assertions.assertEquals(848, activeCells);
        }
    }

    private BufferedReader readInput() {
        return new BufferedReader(
                new InputStreamReader(this.getClass().getResourceAsStream("/test-input.txt"), StandardCharsets.UTF_8));
    }

}
